version: "3.9"

# ===============================
# Maintenance Service Docker Compose
# ===============================
# 
# ‚ö†Ô∏è DATABASE INFRASTRUCTURE CHANGE:
# PostgreSQL database is now managed centrally in infrastructure/data/
# You must start the data infrastructure first:
#   cd ../../infrastructure/data && docker-compose up -d
#
# Database Connection:
# - Uses postgres-maintenance from fleet-data-network
# - Local dev: localhost:5433
# - Docker: postgres-maintenance:5432
#
# Database Initialization:
# - Schema: Created automatically via SQLAlchemy (db.create_all())
# - Sample Data: Seeded automatically by database_seeder.py on every startup
# - The seeder is idempotent - safe to run multiple times
#
# Ports:
# - Maintenance Service: localhost:5001
#
# üìö Documentation:
# - Database Setup: See ../../infrastructure/data/README.md
# - pgAdmin Access: http://localhost:5050 (centralized instance)
# - API Documentation: See README.md for service endpoints and usage

services:
  maintenance-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: maintenance-service
    ports:
      - "5001:5001"
    environment:
      FLASK_ENV: development
      FLASK_APP: run.py
      DATABASE_URL: "postgresql://postgres:postgres@postgres-maintenance:5432/maintenance_db"
      PORT: 5001
      HOST: "0.0.0.0"
      CORS_ORIGINS: "*"
    volumes:
      - ./:/app
    restart: always
    networks:
      - fleet-data-network

networks:
  fleet-data-network:
    external: true


